<div *ngIf="mediaReady; else loading">
  <div class="media__controls">
    <span *ngIf="selectMode" [matTooltip]="'Selected'" class="media__controls-numbers">
      <span class="material-icons-outlined">
        check_box
      </span>
      <span>&nbsp;{{totalSelected}}</span>
    </span>
    <div class="media__controls-tasks">
      <input type="file" #inputFiles placeholder="Choose file" (change)="uploadFiles(inputFiles)"
             style="display:none;" multiple>
      <ng-container *ngIf="selectMode">
        <button mat-icon-button color="primary" aria-label="Select All" matTooltip="Select All"
                (click)="selectAll()">
          <span class="material-icons-outlined">select_all</span>
        </button>
        <button mat-icon-button color="primary" aria-label="Deselect All" matTooltip="Deselect All"
                (click)="deselectAll()">
          <span class="material-icons-outlined">deselect</span>
        </button>
      </ng-container>
      <button mat-icon-button color="primary" aria-label="Albums List" matTooltip="All Albums"
              (click)="showAlbumsList()">
        <span class="material-icons-outlined">format_list_bulleted</span>
      </button>
      <button mat-icon-button color="primary" aria-label="Add To Album" matTooltip="Add To Album"
              (click)="addSelectedToAlbum()">
        <span class="material-icons-outlined">collections</span>
      </button>
      <button mat-icon-button color="primary" aria-label="Upload" matTooltip="Upload media files"
              (click)="inputFiles.click()">
        <span class="material-icons-outlined">cloud_upload</span>
      </button>
    </div>
  </div>
  <mat-divider class="media__divider"></mat-divider>
  <div *ngIf="uploading" class="media_upload-progress">
    <mat-progress-bar mode="determinate" [value]="uploadProgress"></mat-progress-bar>
  </div>

  <h3 *ngIf="displayedMediaObjects.length < 1">
    No content.
  </h3>

  <div class="media__container" *ngIf="mediaReady && columnView === 'one-column'">
    <div class="media__column">
      <ng-container *ngFor="let item of displayedMediaObjects">
        <app-media-item
          [item]="item"
          [xObserver]="intersectionObserver"
          (open)="openMedia($event)"
          [id]="'media-'+item.id"
        ></app-media-item>
      </ng-container>
    </div>
  </div>

  <div class="media__container" *ngIf="mediaReady && columnView === 'two-columns'">
    <div class="media__column">
      <ng-container *ngFor="let item of twoColumns.getColumn(0)">
        <app-media-item
          [item]="item"
          [xObserver]="intersectionObserver"
          (open)="openMedia($event)"
        ></app-media-item>
      </ng-container>
    </div>
    <div class="media__column">
      <ng-container *ngFor="let item of twoColumns.getColumn(1)">
        <app-media-item
          [item]="item"
          [xObserver]="intersectionObserver"
          (open)="openMedia($event)"
        ></app-media-item>
      </ng-container>
    </div>
  </div>

  <div class="media__container" *ngIf="mediaReady && columnView === 'three-columns'">
    <div class="media__column">
      <ng-container *ngFor="let item of threeColumns.getColumn(0)">
        <app-media-item
          [item]="item"
          [xObserver]="intersectionObserver"
          (open)="openMedia($event)"
        ></app-media-item>
      </ng-container>
    </div>
    <div class="media__column">
      <ng-container *ngFor="let item of threeColumns.getColumn(1)">
        <app-media-item
          [item]="item"
          [xObserver]="intersectionObserver"
          (open)="openMedia($event)"
        ></app-media-item>
      </ng-container>
    </div>
    <div class="media__column">
      <ng-container *ngFor="let item of threeColumns.getColumn(2)">
        <app-media-item
          [item]="item"
          [xObserver]="intersectionObserver"
          (open)="openMedia($event)"
        ></app-media-item>
      </ng-container>
    </div>
  </div>
</div>

<ng-template #loading>
  <mat-spinner></mat-spinner>
</ng-template>

<ng-template #newAlbum>
  <div mat-dialog-title class="media__dialog-title">New Album</div>
  <form [formGroup]="newAlbumForm" mat-dialog-content class="media__dialog-content">
    <p></p>
    <div>
      <mat-form-field appearance="outline">
        <mat-label>Album Name</mat-label>
        <input matInput #albumNameInput formControlName="name">
        <mat-error>{{newAlbumErrorMessage()}}</mat-error>
      </mat-form-field>
    </div>
  </form>
  <div mat-dialog-actions class="media__dialog-actions">
    <button mat-raised-button color="primary" [mat-dialog-close]="albumNameInput.value"
            [disabled]="newAlbumForm.invalid">Create
    </button>
    <button mat-raised-button color="accent" [mat-dialog-close]="false">Cancel</button>
  </div>
</ng-template>

<ng-template #addToAlbum>
  <div mat-dialog-title class="media__dialog-title">Add to album</div>
  <div mat-dialog-content class="media__dialog-content">
    <p></p>
    <div>
      <mat-form-field appearance="outline">
        <mat-label>Select Album</mat-label>
        <mat-select #albumSelect [multiple]="true" ngModel>
          <mat-option>
            <ngx-mat-select-search [formControl]="albumFilterCtrl" placeholderLabel="Search"
                                   noEntriesFoundLabel="No results."></ngx-mat-select-search>
          </mat-option>
          <mat-option *ngFor="let item of filteredAlbums$ | async" [value]="item">{{item.name}}</mat-option>
        </mat-select>
      </mat-form-field>
    </div>
  </div>
  <div mat-dialog-actions class="media__dialog-actions">
    <button mat-raised-button color="primary" [mat-dialog-close]="albumSelect.value"
            [disabled]="!albumSelect.value">Add
    </button>
    <button mat-raised-button color="primary" [mat-dialog-close]="'new'">New Album</button>
    <span class="spacer"></span>
    <button mat-raised-button color="accent" [mat-dialog-close]="false">Cancel</button>
  </div>
</ng-template>


<ng-template #mediaViewDialog>
  <div class="media-item__view">
    <video
      *ngIf="activeMediaObject.isVideo"
      [muted]="'muted'"
      autoplay
      loop
      controls
      [src]="'/api/content/'+activeMediaObject?.id"
    >
    </video>
    <img *ngIf="!activeMediaObject.isVideo" [src]="'/api/content/'+activeMediaObject?.id"/>
    <span class="material-icons control control__close" (click)="closeDialog($event)">
      close
    </span>
    <span class="material-icons control control__favorite" [ngClass]="activeMediaObject?.favorite ? 'control--pink': ''"
          (click)="favoriteToggle($event)">
            {{ activeMediaObject?.favorite ? 'favorite' : 'favorite_border' }}
        </span>
    <span class="material-icons control control__left" [ngClass]="activeIndex === 0 ? 'control--disabled': ''"
          (click)="scrollBack($event)">navigate_before</span>
    <span class="material-icons control control__right" [ngClass]="activeIndex === maxScrollIndex ? 'control--disabled': ''"
          (click)="scrollForward($event)">navigate_next</span>
  </div>
</ng-template>


<ng-template #allAlbums>
  <div mat-dialog-title>All Media Albums</div>
  <div mat-dialog-content>
    <mat-selection-list #albumList [multiple]="false" hideSingleSelectionIndicator>
      <mat-list-option value="home" (dblclick)="navigateToAlbum('home')">
        <mat-icon matListItemIcon>home</mat-icon>
        <span matListItemTitle>Home</span>
      </mat-list-option>
      <mat-list-option value="favorites" (dblclick)="navigateToAlbum('favorites')">
        <mat-icon matListItemIcon>favorite</mat-icon>
        <span matListItemTitle>Favorites</span>
      </mat-list-option>
      <mat-list-option *ngFor="let album of allMediaAlbums$ | async" [value]="album" (dblclick)="navigateToAlbum(album)">
        <mat-icon matListItemIcon>collections</mat-icon>
        <span matListItemTitle>{{album.name}}</span>
        <span matListItemLine>Created: {{album.createDate | date: 'mediumDate'}}</span>
      </mat-list-option>
    </mat-selection-list>
  </div>
  <div mat-dialog-actions>
    <button type="button" mat-raised-button color="primary" [mat-dialog-close]="albumList.selectedOptions.selected[0]?.value" [disabled]="!albumList.selectedOptions.hasValue()">View</button>
    <button type="button" mat-raised-button color="accent" [mat-dialog-close]="false">Close</button>
  </div>
</ng-template>
